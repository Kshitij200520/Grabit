"use strict";(self.webpackChunkecommerce_client=self.webpackChunkecommerce_client||[]).push([[700],{2700:(e,r,s)=>{s.r(r),s.d(r,{default:()=>d});var a=s(2555),o=s(9950),n=s(8429),i=s(6844),t=s(5530),c=s(7832),l=(s(7705),s(4414));const d=()=>{const{cartState:e,user:r,dispatch:s}=(0,i._)(),d=(0,n.Zp)(),[m,p]=(0,o.useState)(!1),[u,h]=(0,o.useState)({fullName:"",address:"",city:"",postalCode:"",country:"",paymentMethod:"Razorpay"}),y=e=>{h((0,a.A)((0,a.A)({},u),{},{[e.target.name]:e.target.value}))},x=()=>{const r=e.totalAmount,s=.1*r;return{itemsPrice:r,shippingPrice:5,taxPrice:s,totalPrice:r+5+s}},v=async(e,a)=>{console.log("\ud83c\udfad Starting mock payment process...");if(await new Promise(e=>{if(window.Razorpay)return console.log("\ud83c\udfad Mock Razorpay already loaded!"),void e(!0);setTimeout(()=>{window.Razorpay?(console.log("\ud83c\udfad Mock Razorpay loaded successfully!"),e(!0)):(console.error("\u274c Mock Razorpay failed to load"),e(!1))},100)})){console.log("\ud83c\udfad Mock Razorpay type:",typeof window.Razorpay),console.log("\ud83c\udfad Mock Razorpay constructor:",window.Razorpay.name);try{console.log("Creating Razorpay order...",{orderId:a,amount:e.totalPrice});const o=await t.tv.createOrder({orderId:a,amount:e.totalPrice});console.log("Razorpay order created:",o.data);const n={key:o.data.key,amount:o.data.amount,currency:o.data.currency,name:"E-Shop",description:"Order Payment",order_id:o.data.id,handler:async function(e){try{console.log("Payment successful, verifying...",e);const r=await t.tv.verifyPayment({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,orderId:a});console.log("Payment verification response:",r.data),r.data.success?(c.oR.success("\ud83c\udf89 Payment successful!"),s({type:"CLEAR_CART"}),setTimeout(()=>{c.oR.success("\u2705 Order confirmed! Your payment has been processed successfully.")},1e3),setTimeout(()=>{c.oR.info("\ud83d\ude9a Your order will be delivered within 10 minutes!")},2500),setTimeout(()=>{c.oR.info("\ud83d\udc68\u200d\ufffd A delivery executive will be assigned in 30 seconds!")},4e3),setTimeout(()=>{c.oR.info("\ud83d\udcf1 You will receive delivery updates via notifications!")},5500),setTimeout(()=>{d("/orders/".concat(a))},7e3)):c.oR.error("\u274c Payment verification failed! Please try again.")}catch(p){var r,o,n,i,l,m;console.error("Payment verification error:",p),console.error("Error details:",{response:null===(r=p.response)||void 0===r?void 0:r.data,status:null===(o=p.response)||void 0===o?void 0:o.status,message:p.message});let e="Payment verification failed: ";null!==(n=p.response)&&void 0!==n&&null!==(i=n.data)&&void 0!==i&&i.message?e+=p.response.data.message:null!==(l=p.response)&&void 0!==l&&null!==(m=l.data)&&void 0!==m&&m.error?e+=p.response.data.error:p.message?e+=p.message:e+="Unknown error occurred",c.oR.error("\u274c ".concat(e))}},prefill:{name:u.fullName,email:r.email,contact:"9999999999"},notes:{address:u.address},theme:{color:"#007bff"},modal:{ondismiss:function(){c.oR.warn("Payment cancelled. You can retry anytime.")}}};console.log("\ud83c\udfad Opening Razorpay payment modal..."),console.log("\ud83c\udfad Payment options:",n);const i=new window.Razorpay(n);console.log("\ud83c\udfad Payment object created:",i),console.log("\ud83c\udfad Payment object type:",typeof i.on),i.on("payment.failed",function(e){console.error("\ud83c\udfad Mock payment failed (should not happen):",e.error);let r="Payment failed. ";"BAD_REQUEST_ERROR"===e.error.code?r+="Please check your payment details and try again.":"GATEWAY_ERROR"===e.error.code?r+="Payment gateway error. Please try again after some time.":"NETWORK_ERROR"===e.error.code?r+="Network error. Please check your internet connection.":r+=e.error.description||"Please try again.",c.oR.error("\u274c ".concat(r)),p(!1)}),console.log("\ud83c\udfad Starting mock payment flow..."),i.open()}catch(y){var o,n,i,l,m,h;console.error("Razorpay payment error:",y),console.error("Payment creation error details:",{response:null===(o=y.response)||void 0===o?void 0:o.data,status:null===(n=y.response)||void 0===n?void 0:n.status,message:y.message});let e="Payment initialization failed: ";null!==(i=y.response)&&void 0!==i&&null!==(l=i.data)&&void 0!==l&&l.message?e+=y.response.data.message:null!==(m=y.response)&&void 0!==m&&null!==(h=m.data)&&void 0!==h&&h.error?e+=y.response.data.error:y.message?e+=y.message:e+="Unknown error occurred",c.oR.error(e)}}else c.oR.error("Mock Razorpay failed to load. Please check if mock-razorpay.js is included.")};if(!r)return(0,l.jsx)("div",{className:"checkout-page",children:(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("h2",{children:"Please login to checkout"})})})});if(0===e.items.length)return(0,l.jsx)("div",{className:"checkout-page",children:(0,l.jsx)("div",{className:"container",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{children:"Your cart is empty"}),(0,l.jsx)("button",{onClick:()=>d("/products"),className:"btn btn-primary",children:"Continue Shopping"})]})})});const{itemsPrice:j,shippingPrice:g,taxPrice:f,totalPrice:N}=x();return(0,l.jsxs)("div",{className:"checkout-page",children:[(0,l.jsx)(c.N9,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)("h1",{children:"Checkout"}),(0,l.jsxs)("div",{className:"checkout-content",children:[(0,l.jsx)("div",{className:"checkout-form",children:(0,l.jsxs)("form",{onSubmit:async a=>{a.preventDefault(),p(!0);try{if(!r||!r._id)return c.oR.error("Please login to place an order"),void d("/login");if(!e.items||0===e.items.length)return c.oR.error("Your cart is empty"),void d("/cart");if(!u.fullName||!u.address||!u.city)return void c.oR.error("Please fill all required fields");console.log("Starting checkout process...",{userId:r._id,cartItems:e.items.length,user:r});const{itemsPrice:a,shippingPrice:o,taxPrice:n,totalPrice:i}=x(),l={userId:r._id,orderItems:e.items.map(e=>({product:e.product._id,name:e.product.name,quantity:e.quantity,price:e.price})),shippingAddress:u,paymentMethod:u.paymentMethod,itemsPrice:a,taxPrice:n,shippingPrice:o,totalPrice:i};console.log("Creating order with data:",l);const m=(await t.rX.create(l)).data._id;console.log("Order created successfully:",m),c.oR.success("Order created! Proceeding to payment..."),"Razorpay"===u.paymentMethod?await v(l,m):"Cash on Delivery"===u.paymentMethod?(s({type:"CLEAR_CART"}),c.oR.success("\ud83c\udf89 COD Order Confirmed! Delivery executive assigned. Check order details for delivery info."),d("/orders/".concat(m))):(s({type:"CLEAR_CART"}),c.oR.success("Order placed successfully!"),d("/orders/".concat(m)))}catch(i){var o,n;console.error("Checkout error:",i);const e=(null===(o=i.response)||void 0===o||null===(n=o.data)||void 0===n?void 0:n.message)||i.message||"Error creating order";c.oR.error("Checkout failed: ".concat(e))}finally{p(!1)}},children:[(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{className:"card-header",children:[(0,l.jsx)("h3",{children:"\ud83d\ude9a Delivery Information"}),(0,l.jsx)("p",{className:"delivery-note",children:"\u26a1 Express delivery in 10 minutes!"})]}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Full Name"}),(0,l.jsx)("input",{type:"text",name:"fullName",value:u.fullName,onChange:y,className:"form-control",required:!0})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Address"}),(0,l.jsx)("input",{type:"text",name:"address",value:u.address,onChange:y,className:"form-control",required:!0})]}),(0,l.jsxs)("div",{className:"form-row",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"City"}),(0,l.jsx)("input",{type:"text",name:"city",value:u.city,onChange:y,className:"form-control",required:!0})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Postal Code"}),(0,l.jsx)("input",{type:"text",name:"postalCode",value:u.postalCode,onChange:y,className:"form-control",required:!0})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Country"}),(0,l.jsx)("input",{type:"text",name:"country",value:u.country,onChange:y,className:"form-control",required:!0})]})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:(0,l.jsx)("h3",{children:"\ud83d\udcb3 Payment Method"})}),(0,l.jsx)("div",{className:"card-body",children:(0,l.jsxs)("div",{className:"payment-options",children:[(0,l.jsxs)("label",{className:"payment-option",children:[(0,l.jsx)("input",{type:"radio",name:"paymentMethod",value:"Razorpay",checked:"Razorpay"===u.paymentMethod,onChange:y}),(0,l.jsxs)("div",{className:"payment-info",children:[(0,l.jsx)("strong",{children:"\ud83d\udcb3 Pay with Razorpay"}),(0,l.jsx)("p",{children:"Credit/Debit Card, UPI, Net Banking, Wallets"})]})]}),(0,l.jsxs)("label",{className:"payment-option",children:[(0,l.jsx)("input",{type:"radio",name:"paymentMethod",value:"Cash on Delivery",checked:"Cash on Delivery"===u.paymentMethod,onChange:y}),(0,l.jsxs)("div",{className:"payment-info",children:[(0,l.jsx)("strong",{children:"\ud83d\udcb5 Cash on Delivery"}),(0,l.jsx)("p",{children:"Pay when your order arrives"})]})]})]})})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary place-order-btn",disabled:m,children:m?"Processing...":"Place Order - \u20b9".concat(N.toFixed(2))})]})}),(0,l.jsx)("div",{className:"order-summary",children:(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:(0,l.jsx)("h3",{children:"\ud83d\udcdd Order Summary"})}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("div",{className:"order-items",children:e.items.map(e=>(0,l.jsxs)("div",{className:"order-item",children:[(0,l.jsx)("img",{src:e.product.image,alt:e.product.name}),(0,l.jsxs)("div",{className:"item-info",children:[(0,l.jsx)("h4",{children:e.product.name}),(0,l.jsxs)("p",{children:["Qty: ",e.quantity," \xd7 \u20b9",e.price]})]}),(0,l.jsxs)("div",{className:"item-total",children:["\u20b9",(e.price*e.quantity).toFixed(2)]})]},e.product._id))}),(0,l.jsx)("hr",{}),(0,l.jsxs)("div",{className:"totals",children:[(0,l.jsxs)("div",{className:"total-row",children:[(0,l.jsx)("span",{children:"Items:"}),(0,l.jsxs)("span",{children:["\u20b9",j.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"total-row",children:[(0,l.jsx)("span",{children:"Delivery:"}),(0,l.jsxs)("span",{children:["\u20b9",g.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"total-row",children:[(0,l.jsx)("span",{children:"Tax (10%):"}),(0,l.jsxs)("span",{children:["\u20b9",f.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"total-row final-total",children:[(0,l.jsx)("span",{children:"Total:"}),(0,l.jsxs)("span",{children:["\u20b9",N.toFixed(2)]})]})]}),(0,l.jsxs)("div",{className:"delivery-promise",children:[(0,l.jsxs)("div",{className:"promise-item",children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\ude80"}),(0,l.jsx)("span",{children:"10-minute delivery"})]}),(0,l.jsxs)("div",{className:"promise-item",children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udc68\u200d\ud83c\udf73"}),(0,l.jsx)("span",{children:"Live order tracking"})]}),(0,l.jsxs)("div",{className:"promise-item",children:[(0,l.jsx)("span",{className:"icon",children:"\ud83d\udcf1"}),(0,l.jsx)("span",{children:"Real-time updates"})]})]})]})]})})]})]})]})}},7705:()=>{}}]);