{"ast":null,"code":"import _objectSpread from\"C:/Users/kshit/Desktop/SD Assignment/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{useCart}from'../context/CartContext';import{orderAPI,paymentAPI}from'../services/api';import{toast,ToastContainer}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import'./Checkout.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Checkout=()=>{const{cartState,user,dispatch}=useCart();const navigate=useNavigate();const[loading,setLoading]=useState(false);const[formData,setFormData]=useState({fullName:'',address:'',city:'',postalCode:'',country:'',paymentMethod:'Razorpay'});const handleInputChange=e=>{setFormData(_objectSpread(_objectSpread({},formData),{},{[e.target.name]:e.target.value}));};const calculateTotals=()=>{const itemsPrice=cartState.totalAmount;const shippingPrice=5.00;const taxPrice=itemsPrice*0.1;const totalPrice=itemsPrice+shippingPrice+taxPrice;return{itemsPrice,shippingPrice,taxPrice,totalPrice};};const loadRazorpayScript=()=>{return new Promise(resolve=>{// Check if our mock Razorpay is already loaded\nif(window.Razorpay){console.log('ðŸŽ­ Mock Razorpay already loaded!');resolve(true);return;}// If mock Razorpay is not loaded, wait a bit and try again\nsetTimeout(()=>{if(window.Razorpay){console.log('ðŸŽ­ Mock Razorpay loaded successfully!');resolve(true);}else{console.error('âŒ Mock Razorpay failed to load');resolve(false);}},100);});};const handleRazorpayPayment=async(orderData,orderId)=>{console.log('ðŸŽ­ Starting mock payment process...');const res=await loadRazorpayScript();if(!res){toast.error('Mock Razorpay failed to load. Please check if mock-razorpay.js is included.');return;}console.log('ðŸŽ­ Mock Razorpay type:',typeof window.Razorpay);console.log('ðŸŽ­ Mock Razorpay constructor:',window.Razorpay.name);try{console.log('Creating Razorpay order...',{orderId,amount:orderData.totalPrice});// Create Razorpay order\nconst response=await paymentAPI.createOrder({orderId:orderId,amount:orderData.totalPrice});console.log('Razorpay order created:',response.data);const options={key:response.data.key,amount:response.data.amount,currency:response.data.currency,name:'E-Shop',description:'Order Payment',order_id:response.data.id,handler:async function(response){try{console.log('Payment successful, verifying...',response);// Verify payment\nconst verifyResponse=await paymentAPI.verifyPayment({razorpay_order_id:response.razorpay_order_id,razorpay_payment_id:response.razorpay_payment_id,razorpay_signature:response.razorpay_signature,orderId:orderId});console.log('Payment verification response:',verifyResponse.data);if(verifyResponse.data.success){toast.success('ðŸŽ‰ Payment successful!');// Clear cart\ndispatch({type:'CLEAR_CART'});// Show detailed success messages\nsetTimeout(()=>{toast.success('âœ… Order confirmed! Your payment has been processed successfully.');},1000);setTimeout(()=>{toast.info('ðŸšš Your order will be delivered within 10 minutes!');},2500);setTimeout(()=>{toast.info('ðŸ‘¨â€ï¿½ A delivery executive will be assigned in 30 seconds!');},4000);setTimeout(()=>{toast.info('ðŸ“± You will receive delivery updates via notifications!');},5500);// Redirect to order details\nsetTimeout(()=>{navigate(\"/orders/\".concat(orderId));},7000);}else{toast.error('âŒ Payment verification failed! Please try again.');}}catch(error){var _error$response,_error$response2,_error$response3,_error$response3$data,_error$response4,_error$response4$data;console.error('Payment verification error:',error);console.error('Error details:',{response:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data,status:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status,message:error.message});let errorMessage='Payment verification failed: ';if((_error$response3=error.response)!==null&&_error$response3!==void 0&&(_error$response3$data=_error$response3.data)!==null&&_error$response3$data!==void 0&&_error$response3$data.message){errorMessage+=error.response.data.message;}else if((_error$response4=error.response)!==null&&_error$response4!==void 0&&(_error$response4$data=_error$response4.data)!==null&&_error$response4$data!==void 0&&_error$response4$data.error){errorMessage+=error.response.data.error;}else if(error.message){errorMessage+=error.message;}else{errorMessage+='Unknown error occurred';}toast.error(\"\\u274C \".concat(errorMessage));}},prefill:{name:formData.fullName,email:user.email,contact:'9999999999'},notes:{address:formData.address},theme:{color:'#007bff'},modal:{ondismiss:function(){toast.warn('Payment cancelled. You can retry anytime.');}}};console.log('ðŸŽ­ Opening Razorpay payment modal...');console.log('ðŸŽ­ Payment options:',options);const paymentObject=new window.Razorpay(options);console.log('ðŸŽ­ Payment object created:',paymentObject);console.log('ðŸŽ­ Payment object type:',typeof paymentObject.on);// Add error handler for failed payments (Mock will never trigger this, but keeping for compatibility)\npaymentObject.on('payment.failed',function(response){console.error('ðŸŽ­ Mock payment failed (should not happen):',response.error);let errorMessage='Payment failed. ';if(response.error.code==='BAD_REQUEST_ERROR'){errorMessage+='Please check your payment details and try again.';}else if(response.error.code==='GATEWAY_ERROR'){errorMessage+='Payment gateway error. Please try again after some time.';}else if(response.error.code==='NETWORK_ERROR'){errorMessage+='Network error. Please check your internet connection.';}else{errorMessage+=response.error.description||'Please try again.';}toast.error(\"\\u274C \".concat(errorMessage));setLoading(false);});console.log('ðŸŽ­ Starting mock payment flow...');paymentObject.open();}catch(error){var _error$response5,_error$response6,_error$response7,_error$response7$data,_error$response8,_error$response8$data;console.error('Razorpay payment error:',error);console.error('Payment creation error details:',{response:(_error$response5=error.response)===null||_error$response5===void 0?void 0:_error$response5.data,status:(_error$response6=error.response)===null||_error$response6===void 0?void 0:_error$response6.status,message:error.message});let errorMessage='Payment initialization failed: ';if((_error$response7=error.response)!==null&&_error$response7!==void 0&&(_error$response7$data=_error$response7.data)!==null&&_error$response7$data!==void 0&&_error$response7$data.message){errorMessage+=error.response.data.message;}else if((_error$response8=error.response)!==null&&_error$response8!==void 0&&(_error$response8$data=_error$response8.data)!==null&&_error$response8$data!==void 0&&_error$response8$data.error){errorMessage+=error.response.data.error;}else if(error.message){errorMessage+=error.message;}else{errorMessage+='Unknown error occurred';}toast.error(errorMessage);}};const handleSubmit=async e=>{e.preventDefault();setLoading(true);try{// Validation checks\nif(!user||!user._id){toast.error('Please login to place an order');navigate('/login');return;}if(!cartState.items||cartState.items.length===0){toast.error('Your cart is empty');navigate('/cart');return;}// Validate form data\nif(!formData.fullName||!formData.address||!formData.city){toast.error('Please fill all required fields');return;}console.log('Starting checkout process...',{userId:user._id,cartItems:cartState.items.length,user:user});const{itemsPrice,shippingPrice,taxPrice,totalPrice}=calculateTotals();const orderData={userId:user._id,orderItems:cartState.items.map(item=>({product:item.product._id,name:item.product.name,quantity:item.quantity,price:item.price})),shippingAddress:formData,paymentMethod:formData.paymentMethod,itemsPrice,taxPrice,shippingPrice,totalPrice};console.log('Creating order with data:',orderData);const response=await orderAPI.create(orderData);const orderId=response.data._id;console.log('Order created successfully:',orderId);toast.success('Order created! Proceeding to payment...');if(formData.paymentMethod==='Razorpay'){await handleRazorpayPayment(orderData,orderId);}else if(formData.paymentMethod==='Cash on Delivery'){// Handle COD orders - they are automatically confirmed with delivery assignment\ndispatch({type:'CLEAR_CART'});toast.success('ðŸŽ‰ COD Order Confirmed! Delivery executive assigned. Check order details for delivery info.');navigate(\"/orders/\".concat(orderId));}else{// Handle other payment methods\ndispatch({type:'CLEAR_CART'});toast.success('Order placed successfully!');navigate(\"/orders/\".concat(orderId));}}catch(error){var _error$response9,_error$response9$data;console.error('Checkout error:',error);const errorMessage=((_error$response9=error.response)===null||_error$response9===void 0?void 0:(_error$response9$data=_error$response9.data)===null||_error$response9$data===void 0?void 0:_error$response9$data.message)||error.message||'Error creating order';toast.error(\"Checkout failed: \".concat(errorMessage));}finally{setLoading(false);}};if(!user){return/*#__PURE__*/_jsx(\"div\",{className:\"checkout-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Please login to checkout\"})})})});}if(cartState.items.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"checkout-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your cart is empty\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/products'),className:\"btn btn-primary\",children:\"Continue Shopping\"})]})})});}const{itemsPrice,shippingPrice,taxPrice,totalPrice}=calculateTotals();return/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-page\",children:[/*#__PURE__*/_jsx(ToastContainer,{position:\"top-right\",autoClose:5000,hideProgressBar:false,newestOnTop:false,closeOnClick:true,rtl:false,pauseOnFocusLoss:true,draggable:true,pauseOnHover:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Checkout\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout-form\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDE9A Delivery Information\"}),/*#__PURE__*/_jsx(\"p\",{className:\"delivery-note\",children:\"\\u26A1 Express delivery in 10 minutes!\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Full Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"fullName\",value:formData.fullName,onChange:handleInputChange,className:\"form-control\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"address\",value:formData.address,onChange:handleInputChange,className:\"form-control\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"City\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"city\",value:formData.city,onChange:handleInputChange,className:\"form-control\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Postal Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"postalCode\",value:formData.postalCode,onChange:handleInputChange,className:\"form-control\",required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Country\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"country\",value:formData.country,onChange:handleInputChange,className:\"form-control\",required:true})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCB3 Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-options\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"payment-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:\"Razorpay\",checked:formData.paymentMethod==='Razorpay',onChange:handleInputChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCB3 Pay with Razorpay\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Credit/Debit Card, UPI, Net Banking, Wallets\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"payment-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:\"Cash on Delivery\",checked:formData.paymentMethod==='Cash on Delivery',onChange:handleInputChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCB5 Cash on Delivery\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Pay when your order arrives\"})]})]})]})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary place-order-btn\",disabled:loading,children:loading?'Processing...':\"Place Order - \\u20B9\".concat(totalPrice.toFixed(2))})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"order-summary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCDD Order Summary\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"order-items\",children:cartState.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"order-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.product.image,alt:item.product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:item.product.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Qty: \",item.quantity,\" \\xD7 \\u20B9\",item.price]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-total\",children:[\"\\u20B9\",(item.price*item.quantity).toFixed(2)]})]},item.product._id))}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Items:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",itemsPrice.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Delivery:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",shippingPrice.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Tax (10%):\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",taxPrice.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-row final-total\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",totalPrice.toFixed(2)]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-promise\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"promise-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"icon\",children:\"\\uD83D\\uDE80\"}),/*#__PURE__*/_jsx(\"span\",{children:\"10-minute delivery\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"promise-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"icon\",children:\"\\uD83D\\uDC68\\u200D\\uD83C\\uDF73\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Live order tracking\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"promise-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"icon\",children:\"\\uD83D\\uDCF1\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Real-time updates\"})]})]})]})]})})]})]})]});};export default Checkout;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}