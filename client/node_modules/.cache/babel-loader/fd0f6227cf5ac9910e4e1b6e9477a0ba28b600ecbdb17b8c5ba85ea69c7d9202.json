{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link,useNavigate}from'react-router-dom';import{useCart}from'../context/CartContext';import{cartAPI}from'../services/api';import'./Cart.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Cart=()=>{const{cartState,dispatch,user}=useCart();const[loading,setLoading]=useState(true);const navigate=useNavigate();useEffect(()=>{if(user){loadCart();}else{setLoading(false);}},[user]);const loadCart=async()=>{try{const response=await cartAPI.getCart(user._id);dispatch({type:'SET_CART',payload:response.data});}catch(error){console.error('Error loading cart:',error);}finally{setLoading(false);}};const updateQuantity=async(productId,newQuantity)=>{if(newQuantity<1){removeItem(productId);return;}try{const response=await cartAPI.updateQuantity(user._id,{productId,quantity:newQuantity});dispatch({type:'SET_CART',payload:response.data});}catch(error){var _error$response,_error$response$data;alert(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Error updating quantity');}};const removeItem=async productId=>{try{const response=await cartAPI.removeItem(user._id,productId);dispatch({type:'SET_CART',payload:response.data});}catch(error){var _error$response2,_error$response2$data;alert(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Error removing item');}};const clearCart=async()=>{if(window.confirm('Are you sure you want to clear your cart?')){try{await cartAPI.clearCart(user._id);dispatch({type:'CLEAR_CART'});}catch(error){var _error$response3,_error$response3$data;alert(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Error clearing cart');}}};const proceedToCheckout=()=>{navigate('/checkout');};if(!user){return/*#__PURE__*/_jsx(\"div\",{className:\"cart-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Please login to view your cart\"}),/*#__PURE__*/_jsx(Link,{to:\"/login\",className:\"btn btn-primary\",children:\"Login\"})]})})});}if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading cart...\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"cart-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Shopping Cart\"}),cartState.items.length>0&&/*#__PURE__*/_jsx(\"button\",{onClick:clearCart,className:\"btn btn-danger\",children:\"Clear Cart\"})]}),cartState.items.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-cart\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Your cart is empty\"}),/*#__PURE__*/_jsx(Link,{to:\"/products\",className:\"btn btn-primary\",children:\"Continue Shopping\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"cart-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart-items\",children:cartState.items.map(item=>{// Safety check for product data\nif(!item.product||!item.product._id){console.warn('Cart item missing product data:',item);return null;}return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item-image\",children:/*#__PURE__*/_jsx(\"img\",{src:item.product.image||'https://via.placeholder.com/150x150?text=No+Image',alt:item.product.name||'Product',onError:e=>{e.target.src='https://via.placeholder.com/150x150?text=No+Image';}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:item.product.name||'Unknown Product'}),/*#__PURE__*/_jsx(\"p\",{children:item.product.description||'No description available'}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-price\",children:[\"\\u20B9\",item.price||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-quantity\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>updateQuantity(item.product._id,item.quantity-1),className:\"quantity-btn\",children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{className:\"quantity\",children:item.quantity}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>updateQuantity(item.product._id,item.quantity+1),className:\"quantity-btn\",children:\"+\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-total\",children:[\"\\u20B9\",((item.price||0)*item.quantity).toFixed(2)]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeItem(item.product._id),className:\"remove-btn\",children:\"\\xD7\"})]},item.product._id);}).filter(Boolean)}),/*#__PURE__*/_jsx(\"div\",{className:\"cart-summary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"summary-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Subtotal:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",cartState.totalAmount.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Shipping:\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u20B950.00\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Tax (18% GST):\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",(cartState.totalAmount*0.18).toFixed(2)]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-row total\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",(cartState.totalAmount+50+cartState.totalAmount*0.18).toFixed(2)]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:proceedToCheckout,className:\"btn btn-primary checkout-btn\",children:\"Proceed to Checkout\"})]})]})})]})]})});};export default Cart;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}