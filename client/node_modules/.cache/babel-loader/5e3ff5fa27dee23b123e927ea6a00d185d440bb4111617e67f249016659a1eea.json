{"ast":null,"code":"import React,{useState,useEffect}from'react';import DeliveryNotifications from'./DeliveryNotifications';import{toast}from'react-toastify';import'./OrderStatus.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OrderStatus=_ref=>{var _order$items,_order$customerInfo,_order$customerInfo2,_order$customerInfo3,_order$customerInfo4;let{orderId}=_ref;const[order,setOrder]=useState(null);const[loading,setLoading]=useState(true);const[showNotifications,setShowNotifications]=useState(false);const[error,setError]=useState('');const[currentTime,setCurrentTime]=useState(new Date());useEffect(()=>{const fetchOrderDetails=async()=>{try{const response=await fetch(\"http://localhost:5000/api/orders/\".concat(orderId));if(response.ok){const orderData=await response.json();// Show notification if status changed\nif(order&&order.status!==orderData.status){toast.success(\"Order status updated to: \".concat(orderData.status),{position:\"top-right\",autoClose:4000});}setOrder(orderData);}else{setError('Failed to fetch order details');}}catch(err){console.error('Error fetching order:',err);setError('Error loading order details');}finally{setLoading(false);}};if(orderId){fetchOrderDetails();// Poll for updates every 30 seconds\nconst interval=setInterval(fetchOrderDetails,30000);return()=>clearInterval(interval);}},[orderId]);// Update current time every second for countdown\nuseEffect(()=>{const timeInterval=setInterval(()=>{setCurrentTime(new Date());},1000);return()=>clearInterval(timeInterval);},[]);const refreshOrderDetails=async()=>{setLoading(true);setError('');try{const response=await fetch(\"http://localhost:5000/api/orders/\".concat(orderId));if(response.ok){const orderData=await response.json();setOrder(orderData);toast.info('Order details refreshed!',{position:\"top-right\",autoClose:2000});}else{setError('Failed to fetch order details');}}catch(err){console.error('Error fetching order:',err);setError('Error loading order details');}finally{setLoading(false);}};const getStatusProgress=status=>{const statusOrder=['Pending','Confirmed','Preparing','Out for Delivery','Nearby','Delivered'];const currentIndex=statusOrder.indexOf(status);return Math.max(0,(currentIndex+1)/statusOrder.length*100);};const getStatusColor=status=>{switch(status===null||status===void 0?void 0:status.toLowerCase()){case'pending':return'#ffc107';case'confirmed':return'#28a745';case'preparing':return'#fd7e14';case'out for delivery':return'#6f42c1';case'nearby':return'#dc3545';case'delivered':return'#28a745';default:return'#6c757d';}};const formatCurrency=amount=>{return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR'}).format(amount);};const formatDateTime=dateString=>{const date=new Date(dateString);return{date:date.toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}),time:date.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true})};};const formatTimeRemaining=deliveryTime=>{const now=new Date();const delivery=new Date(deliveryTime);const diffMs=delivery.getTime()-now.getTime();if(diffMs<=0){return\"Delivery time reached\";}const hours=Math.floor(diffMs/(1000*60*60));const minutes=Math.floor(diffMs%(1000*60*60)/(1000*60));const seconds=Math.floor(diffMs%(1000*60)/1000);if(hours>0){return\"\".concat(hours,\"h \").concat(minutes,\"m \").concat(seconds,\"s remaining\");}else if(minutes>0){return\"\".concat(minutes,\"m \").concat(seconds,\"s remaining\");}else{return\"\".concat(seconds,\"s remaining\");}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"order-status-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-spinner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading order details...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"order-status-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u274C Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchOrderDetails,className:\"retry-btn\",children:\"\\uD83D\\uDD04 Retry\"})]})});}if(!order){return/*#__PURE__*/_jsx(\"div\",{className:\"order-status-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"no-order\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCE6 No Order Found\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Order ID: \",orderId]})]})});}const orderDateTime=formatDateTime(order.createdAt);return/*#__PURE__*/_jsxs(\"div\",{className:\"order-status-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order-title\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDCE6 Order #\",order._id.slice(-8).toUpperCase()]}),/*#__PURE__*/_jsxs(\"p\",{className:\"order-date\",children:[\"Placed on \",orderDateTime.date,\" at \",orderDateTime.time]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-amount\",children:[/*#__PURE__*/_jsx(\"h3\",{children:formatCurrency(order.totalAmount)}),/*#__PURE__*/_jsx(\"span\",{className:\"payment-method\",children:order.paymentMethod==='cod'?'ðŸ’µ Cash on Delivery':'ðŸ’³ Online Payment'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-progress\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"progress-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCA Order Progress\"}),/*#__PURE__*/_jsx(\"span\",{className:\"current-status\",style:{color:getStatusColor(order.status)},children:order.status})]}),/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-fill\",style:{width:\"\".concat(getStatusProgress(order.status),\"%\"),backgroundColor:getStatusColor(order.status)}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-labels\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Confirmed\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Preparing\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Out for Delivery\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Delivered\"})]})]}),order.deliveryPersonName&&/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-info-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDE9A Delivery Information\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNotifications(true),className:\"view-details-btn\",children:\"\\uD83D\\uDCF1 View Full Timeline\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-executive\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"executive-avatar\",children:order.deliveryPersonName.charAt(0).toUpperCase()}),/*#__PURE__*/_jsxs(\"div\",{className:\"executive-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:order.deliveryPersonName}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCDE \",order.deliveryPersonPhone]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDEF5 \",order.deliveryPersonVehicle]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rating\",children:['â­'.repeat(Math.floor(order.deliveryPersonRating||4.5)),/*#__PURE__*/_jsxs(\"span\",{children:[order.deliveryPersonRating||4.5,\"/5\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"executive-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"call-btn\",onClick:()=>window.open(\"tel:\".concat(order.deliveryPersonPhone)),children:\"\\uD83D\\uDCDE Call\"}),/*#__PURE__*/_jsx(\"button\",{className:\"track-btn\",children:\"\\uD83D\\uDCCD Track\"})]})]}),order.estimatedDeliveryTime&&/*#__PURE__*/_jsxs(\"div\",{className:\"estimated-delivery\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u23F0 Estimated Delivery\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"delivery-time\",children:[formatDateTime(order.estimatedDeliveryTime).date,\" at \",formatDateTime(order.estimatedDeliveryTime).time]}),/*#__PURE__*/_jsxs(\"p\",{className:\"time-remaining\",children:[\"\\uD83D\\uDD52 \",formatTimeRemaining(order.estimatedDeliveryTime)]})]}),order.deliveryTracking&&order.deliveryTracking.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"latest-update\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCE2 Latest Update\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"update-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"update-status\",style:{color:getStatusColor(order.status)},children:order.status}),/*#__PURE__*/_jsx(\"p\",{children:order.deliveryTracking[order.deliveryTracking.length-1].message}),/*#__PURE__*/_jsx(\"small\",{children:formatDateTime(order.deliveryTracking[order.deliveryTracking.length-1].timestamp).time})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-items-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDECD\\uFE0F Order Items\"}),/*#__PURE__*/_jsx(\"div\",{className:\"items-list\",children:(_order$items=order.items)===null||_order$items===void 0?void 0:_order$items.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"item-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:item.name}),/*#__PURE__*/_jsx(\"p\",{children:item.description})]}),/*#__PURE__*/_jsx(\"div\",{className:\"item-quantity\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Qty: \",item.quantity]})}),/*#__PURE__*/_jsx(\"div\",{className:\"item-price\",children:/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(item.price*item.quantity)})})]},index))}),/*#__PURE__*/_jsx(\"div\",{className:\"order-total\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total Amount:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"total-amount\",children:formatCurrency(order.totalAmount)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"customer-info-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDC64 Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"customer-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Name:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_order$customerInfo=order.customerInfo)===null||_order$customerInfo===void 0?void 0:_order$customerInfo.name)||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Email:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_order$customerInfo2=order.customerInfo)===null||_order$customerInfo2===void 0?void 0:_order$customerInfo2.email)||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Phone:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_order$customerInfo3=order.customerInfo)===null||_order$customerInfo3===void 0?void 0:_order$customerInfo3.phone)||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Address:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:((_order$customerInfo4=order.customerInfo)===null||_order$customerInfo4===void 0?void 0:_order$customerInfo4.address)||'N/A'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNotifications(true),className:\"action-btn primary\",children:\"\\uD83D\\uDCF1 View Full Timeline\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshOrderDetails,className:\"action-btn secondary\",children:\"\\uD83D\\uDD04 Refresh Status\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn secondary\",children:\"\\uD83D\\uDCC4 Download Invoice\"})]}),showNotifications&&/*#__PURE__*/_jsx(DeliveryNotifications,{order:order,onClose:()=>setShowNotifications(false)})]});};export default OrderStatus;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}